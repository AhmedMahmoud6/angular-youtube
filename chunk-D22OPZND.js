import{a as b,b as $,c as q,d as B,e as G}from"./chunk-7XMPNCOM.js";import{$ as k,B as C,Ea as W,F as h,G as E,H as r,Ha as Z,I as M,J as _,M as g,O,S as a,T as l,U as s,V as p,Z as P,aa as c,da as N,ea as R,fa as L,ga as F,ha as U,k as T,ka as u,la as v,na as A,oa as H,ra as z,s as f,sa as Y,t as D,u as x,xa as Q,ya as j,z as m}from"./chunk-HTKGOQCI.js";var ee=n=>["/video",n];function ie(n,i){if(n&1&&(l(0,"div",15),p(1,"img",16),l(2,"p"),u(3),s()()),n&2){let e,t=i.ngIf,o=c(2);U("opacity",o.previewVisible()?0:1)("transition","opacity 0.28s ease"),r(),a("src",t,h)("alt",(e=o.finalVideo().videoDetails.snippet)==null?null:e.title),r(2),v(o.formatYouTubeDuration(o.finalVideo().videoDetails.contentDetails.duration))}}function te(n,i){if(n&1&&(l(0,"div",15),p(1,"img",16),s()),n&2){let e,t,o=c(2);r(),a("src",(e=o.finalVideo())==null||e.videoDetails==null||e.videoDetails.snippet==null||e.videoDetails.snippet.thumbnails==null||e.videoDetails.snippet.thumbnails.high==null?null:e.videoDetails.snippet.thumbnails.high.url,h)("alt",(t=o.finalVideo())==null||t.videoDetails==null||t.videoDetails.snippet==null?null:t.videoDetails.snippet.title)}}function ne(n,i){if(n&1&&(l(0,"div",17),p(1,"iframe",18),s()),n&2){let e=i.ngIf;r(),a("src",e,E)}}function oe(n,i){if(n&1){let e=P();l(0,"div",2),k("mouseenter",function(){D(e);let o=c();return x(o.showPreview())})("mouseleave",function(){D(e);let o=c();return x(o.hidePreview())}),l(1,"div",3),g(2,ie,4,7,"div",4)(3,te,2,2,"ng-template",null,0,H)(5,ne,2,1,"div",5),s(),l(6,"div",6)(7,"div",7),p(8,"img",8),s(),l(9,"div",9)(10,"div",10),u(11),s(),l(12,"div",11),u(13),s(),l(14,"div",12)(15,"p",13),u(16),s(),l(17,"span"),u(18,"\u2022"),s(),l(19,"p",14),u(20),s()()()()()}if(n&2){let e,t,o,w,I,S,J=F(4),d=c();a("routerLink",A(9,ee,d.finalVideo().videoDetails.id)),r(2),a("ngIf",(e=d.finalVideo())==null||e.videoDetails==null||e.videoDetails.snippet==null||e.videoDetails.snippet.thumbnails==null||e.videoDetails.snippet.thumbnails.maxres==null?null:e.videoDetails.snippet.thumbnails.maxres.url)("ngIfElse",J),r(3),a("ngIf",d.iframeSrc()),r(3),a("src",(t=d.finalVideo())==null?null:t.channelProfilePic,h),r(3),v((o=d.finalVideo())==null?null:o.videoDetails.snippet.title),r(2),v((w=d.finalVideo())==null?null:w.videoDetails.snippet.channelTitle),r(3),v(d.formatViews((I=d.finalVideo())==null?null:I.videoDetails.statistics.viewCount)),r(4),v(d.timeAgo((S=d.finalVideo())==null?null:S.videoDetails.snippet.publishedAt))}}var V=class n{constructor(i){this.youtubeService=i}video=Y();channel=m([]);finalVideo=m(void 0);previewVisible=m(!1);iframeSrc=m(null);timerId;sanitizer=f(W);formatViews=q;timeAgo=$;formatYouTubeDuration=G;ngOnInit(){let i=this.video();i?.snippet.channelId&&this.youtubeService.getChannel(i.snippet.channelId).subscribe(e=>{this.channel.set(e.items),this.finalVideo.set(B(this.video(),this.channel()))})}showPreview(){this.timerId=setTimeout(()=>{let i=this.finalVideo()?.videoDetails?.id;if(!i)return;let e=new URLSearchParams({autoplay:"1",mute:"1",controls:"0",rel:"0",modestbranding:"1",playsinline:"1",loop:"1",playlist:i}),t=`https://www.youtube.com/embed/${i}?${e.toString()}`;this.iframeSrc.set(this.sanitizer.bypassSecurityTrustResourceUrl(t)),this.previewVisible.set(!0)},300)}hidePreview(){this.previewVisible.set(!1),this.iframeSrc.set(null),clearTimeout(this.timerId)}static \u0275fac=function(e){return new(e||n)(M(b))};static \u0275cmp=_({type:n,selectors:[["app-video-card"]],inputs:{video:[1,"video"]},decls:1,vars:1,consts:[["fallbackImg",""],["class","video card ",3,"routerLink","mouseenter","mouseleave",4,"ngIf"],[1,"video","card",3,"mouseenter","mouseleave","routerLink"],[1,"video-media"],["class","video-img",3,"opacity","transition",4,"ngIf","ngIfElse"],["class","video-preview",4,"ngIf"],[1,"video-info"],[1,"left-side"],["alt","Channel pfp",3,"src"],[1,"center"],[1,"video-title"],[1,"channel-title"],[1,"video-more-info"],[1,"video-views"],[1,"video-date"],[1,"video-img"],[3,"src","alt"],[1,"video-preview"],["width","100%","height","100%","frameborder","0","allow","autoplay; encrypted-media; picture-in-picture","allowfullscreen","",3,"src"]],template:function(e,t){e&1&&g(0,oe,21,11,"div",1),e&2&&a("ngIf",t.finalVideo())},dependencies:[j,Z],encapsulation:2})};var le=["sentinel"];function re(n,i){if(n&1&&p(0,"app-video-card",4),n&2){let e=i.$implicit;a("video",e)}}var y=class n{youtubeService=f(b);ngZone=f(O);videos=m([]);nextPageToken=m(void 0);isLoading=m(!1);error=m(null);observer;sentinel;loadMore(){if(this.isLoading()||this.nextPageToken()===null&&this.videos().length>0)return;this.isLoading.set(!0);let i=this.nextPageToken()??void 0;this.youtubeService.getVideos(i).pipe(T(1)).subscribe({next:e=>{let t=e.items??[];this.videos.set([...this.videos(),...t]),this.nextPageToken.set(e.nextPageToken??null),console.log("calling getVideos with token:",i),e.nextPageToken||this.observer?.disconnect()},error:e=>{console.error(e),this.error.set("Failed To Load Videos")},complete:()=>this.isLoading.set(!1)})}setupObserver(){let i={root:null,rootMargin:"300px",threshold:.1};this.observer=new IntersectionObserver(e=>{for(let t of e)t.isIntersecting&&this.ngZone.run(()=>this.loadMore())},i),setTimeout(()=>{let e=this.sentinel?.nativeElement;e&&this.observer?.observe(e)},0)}ngAfterViewInit(){this.loadMore(),this.setupObserver()}ngOnDestroy(){this.observer?.disconnect()}constructor(){z(()=>{console.log(this.videos())})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=_({type:n,selectors:[["app-home"]],viewQuery:function(e,t){if(e&1&&N(le,5,C),e&2){let o;R(o=L())&&(t.sentinel=o.first)}},decls:4,vars:1,consts:[["sentinel",""],[1,"app-container"],[3,"video",4,"ngFor","ngForOf"],[1,"sentinel"],[3,"video"]],template:function(e,t){e&1&&(l(0,"div",1),g(1,re,1,1,"app-video-card",2),p(2,"div",3,0),s()),e&2&&(r(),a("ngForOf",t.videos()))},dependencies:[V,Q],encapsulation:2})};var Ne=[{path:"",component:y}];export{Ne as HOME_ROUTES};
