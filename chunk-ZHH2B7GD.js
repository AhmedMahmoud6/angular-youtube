import{Fa as v,Ga as x,a as g,b as S,h as $,l as h,p as w,s as C}from"./chunk-57H7AMYZ.js";var b={production:!1,apiKey:"AIzaSyDWsKhi_G5QGsBNKcCpXmf7ARoU19ues2M",videosUrl:"https://www.googleapis.com/youtube/v3",channelUrl:"https://www.googleapis.com/youtube/v3/channels"};var y=class t{constructor(e){this.http=e}apiKey=b.apiKey;apiUrl=b.videosUrl;channelUrl=b.channelUrl;params={part:"snippet,statistics,contentDetails",chart:"mostPopular",regionCode:"EG",maxResults:"20"};videoParams={part:"snippet,statistics,contentDetails"};getVideos(e){let n=g(g({},this.params),e?{pageToken:e}:{}),r=new v({fromObject:n});return this.http.get(`${this.apiUrl}/videos?key=${this.apiKey}`,{params:r})}getVideoById(e){return this.http.get(`${this.apiUrl}/videos?key=${this.apiKey}&id=${e}`,{params:this.videoParams})}getChannel(e){return this.http.get(`${this.channelUrl}?key=${this.apiKey}&id=${e}&part=brandingSettings`,{params:this.videoParams})}getVideoComments(e,n){if(!e)return console.error("getVideoComments called without videoId!"),$(()=>new Error("videoId is required"));let r=S(g({part:"snippet,replies",order:"relevance"},n?{pageToken:n}:{}),{videoId:e}),s=new v({fromObject:r});return this.http.get(`${this.apiUrl}/commentThreads?key=${this.apiKey}`,{params:s})}static \u0275fac=function(n){return new(n||t)(C(x))};static \u0275prov=w({token:t,factory:t.\u0275fac,providedIn:"root"})};function F(t){let e=new Date(t),r=(new Date().getTime()-e.getTime())/1e3,s={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(let l in s){let o=Math.floor(r/s[l]);if(o>=1)return`${o} ${l}${o>1?"s":""} ago`}return"just now"}function K(t,e="views"){let n=typeof t=="string"?parseInt(t):t;return n>=1e9?(n/1e9).toFixed(1).replace(/\.0$/,"")+`B ${e}`:n>=1e6?(n/1e6).toFixed(1).replace(/\.0$/,"")+`M ${e}`:n>=1e3?(n/1e3).toFixed(1).replace(/\.0$/,"")+`K ${e}`:n+` ${e}`}function j(t,e){let n=e[0];return{videoDetails:{contentDetails:{duration:t.contentDetails.duration},statistics:{viewCount:t.statistics.viewCount,commentCount:t.statistics.commentCount,likeCount:t.statistics.likeCount,subscriberCount:n.statistics.subscriberCount},snippet:{thumbnails:t.snippet.thumbnails,channelId:t.snippet.channelId,title:t.snippet.title,channelTitle:t.snippet.channelTitle,publishedAt:t.snippet.publishedAt,description:t.snippet.description},id:t.id,brandingSettings:{image:{bannerExternalUrl:n.brandingSettings.image?.bannerExternalUrl??""}}},channelId:n.id,channelProfilePic:n.snippet.thumbnails.default?.url??""}}function D(t){let e=t.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/),n=parseInt(e?.[1]||"0",10),r=parseInt(e?.[2]||"0",10),s=parseInt(e?.[3]||"0",10);return n>0?`${n}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${r}:${s.toString().padStart(2,"0")}`}function A(t){if(t==null)return"N/A subscribers";let e=typeof t=="string"?parseInt(t):t;return isNaN(e)||e<0?"0 subscribers":e>=1e9?(e/1e9).toFixed(1).replace(/\.0$/,"")+"B subscribers":e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M subscribers":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"K subscribers":e+" subscribers"}function V(t,e,n,r,s,l,o,p,m,f){if(s==="videos"){if(t()||e()===null&&o().length>0)return;t.set(!0);let c=e()??void 0;n.getVideos(c).pipe(h(1)).subscribe({next:i=>{let a=i.items??[];o?.set([...o(),...a]),e.set(i.nextPageToken??null),i.nextPageToken||r?.disconnect()},error:i=>{console.error(i),l?.set("Failed To Load Videos")},complete:()=>t.set(!1)})}else if(s==="comments"){if(!m){console.warn("loadMore: missing videoId -> abort");return}if(t()){console.log("loadMore: already loading -> abort");return}if(e()===null&&p().length>0){console.log("loadMore: nextPageToken is null and have items -> abort");return}t.set(!0);let c=e()??void 0;n.getVideoComments(m,c).pipe(h(1)).subscribe({next:i=>{let a=i.items??[];if(p?.set([...p(),...a]),p){let u=new Map;p().forEach(d=>{u.set(d.snippet.topLevelComment.id,d.replies.comments)}),f?.set(u)}e.set(i.nextPageToken??null),i.nextPageToken||r?.disconnect()},error:i=>{console.error("loadMore: comments error",i),l?.set("Failed To Load Comments")},complete:()=>{t.set(!1)}})}}function N(t,e,n,r,s,l,o,p,m,f,c){if(!t?.nativeElement){console.warn("setupObserver: sentinel not available yet");return}let i={root:null,rootMargin:"300px",threshold:0},a;return e.runOutsideAngular(()=>{a=new IntersectionObserver(u=>{for(let d of u)d.isIntersecting&&e.run(()=>V(n,r,s,a,l,o,p,m,f,c))},i),a.observe(t.nativeElement)}),a}export{y as a,F as b,K as c,j as d,D as e,A as f,V as g,N as h};
