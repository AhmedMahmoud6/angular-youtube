import{g as C,m as S,o as V}from"./chunk-VRIKBWOE.js";function x(o,l,t,s,n,i,b,e,W,g,a,u,f,p,c,v,h,w){if(console.log("Loading",s),s==="videos"){if(o()||l()===null&&i().length>0)return;o.set(!0);let m=l()??void 0;t.getVideos(m).pipe(S(1)).subscribe({next:r=>{let d=r.items??[];i?.set([...i(),...d]),l.set(r.nextPageToken??null)},error:r=>{console.error(r),n?.set("Failed To Load Videos")},complete:()=>o.set(!1)});return}else if(s==="comments"){if(!e){console.warn("loadMore: missing videoId -> abort");return}if(o()){console.log("loadMore: already loading -> abort");return}if(l()===null&&b().length>0){console.log("loadMore: nextPageToken is null and have items -> abort");return}o.set(!0);let m=l()??void 0;t.getVideoComments(e,m).pipe(S(1)).subscribe({next:r=>{let d=r.items??[];b?.set([...b(),...d]),l.set(r.nextPageToken??null),c?.set(c()+1),r.nextPageToken||h?.set(!0)},error:r=>{r.status===403&&r.error?.error?.errors?.[0]?.reason==="commentsDisabled"?n?.set("Comments are disabled for this video."):n?.set("An unexpected error occurred."),o.set(!1)},complete:()=>{o.set(!1)}});return}else if(s==="suggested"){if(u()){console.log("loadMore: already loading -> abort");return}if(a()===null&&g().length>0){console.log("loadMore: nextPageToken is null and have items -> abort");return}u.set(!0);let m=a()??void 0;t.getVideoSuggestions(m,W).pipe(S(1),V(r=>{if(r.items.length===0){let d=t.homeVideoCategoryId?.();return t.isVideoFromHome()||t.homeVideoCategoryId.set(void 0),t.getSuggestedVideos(m,d??p?.())}return C(r)})).subscribe({next:r=>{let d=r.items;g?.set([...g(),...d]),v?.set(v()+1),a?.set(r.nextPageToken),r.nextPageToken||w?.set(!0)},error:r=>{console.error("loadMore: suggestedVids error",r),f?.set("Failed To Load Suggested Videos"),u?.set(!1)},complete:()=>{u?.set(!1)}});return}}function k(o,l,t,s,n,i){if(n().get(t)??!1)return;let e=i().get(t)??void 0;if(e===null)return;let W=new Map(n());W.set(t,!0),n.set(W),o.getCommentReplies(e,t).pipe(S(1)).subscribe({next:g=>{let a=g.items??[],u=new Map(i());if(u.set(t,g?.nextPageToken??null),i.set(u),a.length>0){let f=new Map(l()),p=f.get(t)??[];f.set(t,[...p,...a]),l.set(f);let c=new Map(n());c.set(t,!1),n.set(c)}},error:g=>{console.error("loadMore: comments error",g),s?.set("Failed To Load Comments");let a=new Map(n());a.set(t,!1),n.set(a)}})}function E(o,l){let t=new WeakMap,s=new IntersectionObserver(n=>{for(let i of n){if(!i.isIntersecting)continue;let b=i.target,e=t.get(b);e&&o.run(()=>{x(e.isLoading,e.nextPageToken,e.youtubeService,e.loadWhat,e.error,e.videos,e.comments,e.videoId,e.videoTags,e.suggestedVideos,e.suggestedNextPageToken,e.suggestedIsLoading,e.suggestedError,e.videoCategoryId,e.commentsCounter,e.suggestedCounter,e.commentsComplete,e.suggestedComplete)})}},l);return{observer:s,observeElement(n,i){n&&(t.set(n,i),s.observe(n))},unobserveElement(n){n&&(t.delete(n),s.unobserve(n))},disconnect(){s.disconnect(),t=new WeakMap}}}export{x as a,k as b,E as c};
