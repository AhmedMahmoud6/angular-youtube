import{a as U}from"./chunk-BF7W5C4N.js";import{$ as u,D as a,Ga as A,Ha as N,K as O,N as o,Oa as q,P as C,Qa as R,S as g,Ua as $,Va as F,Y as d,Z as r,_ as s,_a as Q,da as v,e as b,ea as f,g as p,ga as P,h as y,ia as M,ja as S,k as _,ma as D,n as I,na as L,o as k,oa as V,p as x,q as T,ta as l,ua as c,v as h,w,x as E}from"./chunk-ARSTZJ72.js";var j=["searchSentinel"];function z(n,e){if(n&1){let t=P();r(0,"div",6),M("click",function(){let m=w(t).$implicit,Y=S(2);return E(Y.router.navigate(["/video",m.id.videoId]))}),r(1,"div",7),u(2,"img",8),s(),r(3,"div",9)(4,"h3"),l(5),s(),r(6,"div",10)(7,"p"),l(8),s()(),r(9,"div",11)(10,"p"),l(11),s()(),r(12,"div",12)(13,"p"),l(14),s()()()()}if(n&2){let t=e.$implicit,i=S(2);o(2),d("src",t.snippet.thumbnails.high==null?null:t.snippet.thumbnails.high.url,O),o(3),c(i.decodeHtml(t.snippet.title)),o(3),c(i.timeAgo(t.snippet.publishedAt)),o(3),c(t.snippet.channelTitle),o(3),c(t.snippet.description)}}function W(n,e){if(n&1&&(r(0,"div",4),g(1,z,15,5,"div",5),s()),n&2){let t=S();o(),d("ngForOf",t.videos())}}function B(n,e){n&1&&(v(0),r(1,"div",13),u(2,"mat-progress-spinner",14),s(),f())}function G(n,e){n&1&&(v(0),r(1,"h1",15),l(2,"You're Offline, Check your Internet And Try Again"),s(),f())}function J(n,e){n&1&&(v(0),r(1,"h1",15),l(2,"Failed To Load Videos"),s(),f())}var H=class n{searchSentinel;observer;decodeHtml=Q;timeAgo=F;videos=a([]);isLoading=a(!1);error=a(null);nextPageToken=a(null);query=a("");youtube=h($);route=h(q);router=h(R);destroy$=new b;isOnline=a(window.navigator.onLine);ngOnInit(){this.route.queryParamMap.pipe(y(e=>(console.log(e.get("q")),e.get("q")??"")),I(),T(e=>{this.query.set(e),this.videos.set([]),this.nextPageToken.set(null)}),k(e=>{let t=this.nextPageToken()??void 0;return e?this.youtube.getSearchResults(e,t).pipe(_(i=>(this.error.set(i?.message??"Search failed"),p({items:[],nextPageToken:null})))):p({items:[],nextPageToken:null})}),x(this.destroy$)).subscribe({next:e=>{this.videos.set(e.items),this.nextPageToken.set(e.nextPageToken??null),this.isLoading.set(!1)},error:e=>{this.error.set(e?.message??"Unknown error"),this.isLoading.set(!1)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.observer.unobserve(this.searchSentinel.nativeElement),this.observer.disconnect()}ngAfterViewInit(){let e={root:null,rootMargin:"300px",threshold:1};this.observer=new IntersectionObserver(t=>{for(let i of t)i.isIntersecting&&this.loadMoreSearchVideos()},e),this.observer.observe(this.searchSentinel.nativeElement)}loadMoreSearchVideos(){let e=this.query(),t=this.nextPageToken();!e||!t||(this.isLoading.set(!0),this.youtube.getSearchResults(e,t).pipe(_(i=>(this.error.set(i?.message??"Load more failed"),p({items:[],nextPageToken:null}))),x(this.destroy$)).subscribe(i=>{this.videos.set([...this.videos(),...i.items??[]]),this.nextPageToken.set(i.nextPageToken??null),this.isLoading.set(!1)}))}constructor(){window.addEventListener("online",()=>{this.isOnline.set(!0)}),window.addEventListener("offline",()=>{this.isOnline.set(!1)})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=C({type:n,selectors:[["app-search"]],viewQuery:function(t,i){if(t&1&&D(j,5),t&2){let m;L(m=V())&&(i.searchSentinel=m.first)}},decls:6,vars:4,consts:[["searchSentinel",""],["class","search-page-parent",4,"ngIf"],[4,"ngIf"],["aria-hidden","true",1,"search-sentinel"],[1,"search-page-parent"],["class","search-video",3,"click",4,"ngFor","ngForOf"],[1,"search-video",3,"click"],[1,"search-video-left"],["alt","video thumbnail",3,"src"],[1,"search-video-right"],[1,"search-video-details"],[1,"search-video-channel-details"],[1,"search-video-desc"],[1,"loading-spinner"],["mode","indeterminate","diameter","50","strokeWidth","4"],[1,"error-h1"]],template:function(t,i){t&1&&(g(0,W,2,1,"div",1)(1,B,3,0,"ng-container",2),u(2,"div",3,0),g(4,G,3,0,"ng-container",2)(5,J,3,0,"ng-container",2)),t&2&&(d("ngIf",i.videos()),o(),d("ngIf",i.isLoading()),o(3),d("ngIf",!i.isOnline()),o(),d("ngIf",i.error()))},dependencies:[N,A,U],encapsulation:2})};export{H as Search};
