import{g as p,m,o as v}from"./chunk-VRIKBWOE.js";function V(i,s,e,l,t,o,b,n,S,u,a,d,c,W){if(console.log("Loading",l),l==="videos"){if(i()||s()===null&&o().length>0)return;i.set(!0);let g=s()??void 0;e.getVideos(g).pipe(m(1)).subscribe({next:r=>{let f=r.items??[];o?.set([...o(),...f]),s.set(r.nextPageToken??null)},error:r=>{console.error(r),t?.set("Failed To Load Videos")},complete:()=>i.set(!1)});return}else if(l==="comments"){if(!n){console.warn("loadMore: missing videoId -> abort");return}if(i()){console.log("loadMore: already loading -> abort");return}if(s()===null&&b().length>0){console.log("loadMore: nextPageToken is null and have items -> abort");return}i.set(!0);let g=s()??void 0;e.getVideoComments(n,g).pipe(m(1)).subscribe({next:r=>{let f=r.items??[];b?.set([...b(),...f]),s.set(r.nextPageToken??null),r.nextPageToken},error:r=>{r.status===403&&r.error?.error?.errors?.[0]?.reason==="commentsDisabled"?t?.set("Comments are disabled for this video."):t?.set("An unexpected error occurred."),i.set(!1)},complete:()=>{i.set(!1)}});return}else if(l==="suggested"){if(d()){console.log("loadMore: already loading -> abort");return}if(a()===null&&u().length>0){console.log("loadMore: nextPageToken is null and have items -> abort");return}d.set(!0);let g=a()??void 0;console.log("Inside suggested"),e.getVideoSuggestions(g,S).pipe(m(1),v(r=>{if(r.items.length===0){let f=e.homeVideoCategoryId?.();return e.isVideoFromHome()||e.homeVideoCategoryId.set(void 0),e.getSuggestedVideos(g,f??W?.())}return p(r)})).subscribe({next:r=>{let f=r.items;u?.set([...u(),...f]),a?.set(r.nextPageToken),r.nextPageToken},error:r=>{console.error("loadMore: comments error",r),c?.set("Failed To Load Comments"),d?.set(!1)},complete:()=>{d?.set(!1)}});return}}function w(i,s,e,l,t,o){if(t().get(e)??!1)return;let n=o().get(e)??void 0;if(n===null)return;let S=new Map(t());S.set(e,!0),t.set(S),i.getCommentReplies(n,e).pipe(m(1)).subscribe({next:u=>{let a=u.items??[],d=new Map(o());if(d.set(e,u?.nextPageToken??null),o.set(d),a.length>0){let c=new Map(s()),W=c.get(e)??[];c.set(e,[...W,...a]),s.set(c);let g=new Map(t());g.set(e,!1),t.set(g)}},error:u=>{console.error("loadMore: comments error",u),l?.set("Failed To Load Comments");let a=new Map(t());a.set(e,!1),t.set(a)}})}function C(i,s){let e=new WeakMap,l=new IntersectionObserver(t=>{for(let o of t){if(!o.isIntersecting)continue;let b=o.target,n=e.get(b);n&&i.run(()=>{V(n.isLoading,n.nextPageToken,n.youtubeService,n.loadWhat,n.error,n.videos,n.comments,n.videoId,n.videoTags,n.suggestedVideos,n.suggestedNextPageToken,n.suggestedIsLoading,n.suggestedError,n.videoCategoryId)})}},s);return{observer:l,observeElement(t,o){t&&(e.set(t,o),l.observe(t))},unobserveElement(t){t&&(e.delete(t),l.unobserve(t))},disconnect(){l.disconnect(),e=new WeakMap}}}export{w as a,C as b};
