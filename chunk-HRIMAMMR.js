import{a as U}from"./chunk-HZ4FE6VA.js";import{$ as v,D as a,Ga as A,Ha as N,K as O,N as r,Oa as q,P as C,Qa as R,S as u,Ua as $,Va as F,Y as d,Z as o,_ as s,_a as Q,da as f,e as b,ea as x,g as h,ga as P,h as y,ia as M,ja as m,k as S,ma as D,n as I,na as L,o as k,oa as V,p as _,q as T,ta as l,ua as c,v as g,w,x as E}from"./chunk-VRIKBWOE.js";var j=["searchSentinel"];function z(n,t){if(n&1){let e=P();o(0,"div",6),M("click",function(){let p=w(e).$implicit,Y=m(2);return E(Y.router.navigate(["/video",p.id.videoId]))}),o(1,"div",7),v(2,"img",8),s(),o(3,"div",9)(4,"h3"),l(5),s(),o(6,"div",10)(7,"p"),l(8),s()(),o(9,"div",11)(10,"p"),l(11),s()(),o(12,"div",12)(13,"p"),l(14),s()()()()}if(n&2){let e=t.$implicit,i=m(2);r(2),d("src",e.snippet.thumbnails.high==null?null:e.snippet.thumbnails.high.url,O),r(3),c(i.decodeHtml(e.snippet.title)),r(3),c(i.timeAgo(e.snippet.publishedAt)),r(3),c(e.snippet.channelTitle),r(3),c(e.snippet.description)}}function W(n,t){if(n&1&&(o(0,"div",4),u(1,z,15,5,"div",5),s()),n&2){let e=m();r(),d("ngForOf",e.videos())}}function B(n,t){n&1&&(f(0),o(1,"div",13),v(2,"mat-progress-spinner",14),s(),x())}function G(n,t){n&1&&(f(0),o(1,"h1",15),l(2,"You're Offline, Check your Internet And Try Again"),s(),x())}function J(n,t){if(n&1&&(f(0),o(1,"h1",15),l(2),s(),x()),n&2){let e=m();r(2),c(e.error())}}var H=class n{searchSentinel;observer;decodeHtml=Q;timeAgo=F;videos=a([]);isLoading=a(!1);error=a(null);nextPageToken=a(null);query=a("");youtube=g($);route=g(q);router=g(R);destroy$=new b;isOnline=a(window.navigator.onLine);ngOnInit(){this.route.queryParamMap.pipe(y(t=>(console.log(t.get("q")),t.get("q")??"")),I(),T(t=>{this.query.set(t),this.videos.set([]),this.nextPageToken.set(null)}),k(t=>{let e=this.nextPageToken()??void 0;return t?this.youtube.getSearchResults(t,e).pipe(S(i=>(this.error.set(i?.message??"Search failed"),h({items:[],nextPageToken:null})))):h({items:[],nextPageToken:null})}),_(this.destroy$)).subscribe({next:t=>{this.videos.set(t.items),this.nextPageToken.set(t.nextPageToken??null),this.isLoading.set(!1)},error:t=>{this.error.set(t?.message??"Unknown error"),this.isLoading.set(!1)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.observer.unobserve(this.searchSentinel.nativeElement),this.observer.disconnect()}ngAfterViewInit(){let t={root:null,rootMargin:"300px",threshold:1};this.observer=new IntersectionObserver(e=>{for(let i of e)i.isIntersecting&&this.loadMoreSearchVideos()},t),this.observer.observe(this.searchSentinel.nativeElement)}loadMoreSearchVideos(){let t=this.query(),e=this.nextPageToken();!t||!e||(this.isLoading.set(!0),this.youtube.getSearchResults(t,e).pipe(S(i=>(this.error.set(i?.message??"Load more failed"),h({items:[],nextPageToken:null}))),_(this.destroy$)).subscribe(i=>{this.videos.set([...this.videos(),...i.items??[]]),this.nextPageToken.set(i.nextPageToken??null),this.isLoading.set(!1)}))}constructor(){window.addEventListener("online",()=>{this.isOnline.set(!0)}),window.addEventListener("offline",()=>{this.isOnline.set(!1)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=C({type:n,selectors:[["app-search"]],viewQuery:function(e,i){if(e&1&&D(j,5),e&2){let p;L(p=V())&&(i.searchSentinel=p.first)}},decls:6,vars:4,consts:[["searchSentinel",""],["class","search-page-parent",4,"ngIf"],[4,"ngIf"],["aria-hidden","true",1,"search-sentinel"],[1,"search-page-parent"],["class","search-video",3,"click",4,"ngFor","ngForOf"],[1,"search-video",3,"click"],[1,"search-video-left"],["alt","video thumbnail",3,"src"],[1,"search-video-right"],[1,"search-video-details"],[1,"search-video-channel-details"],[1,"search-video-desc"],[1,"loading-spinner"],["mode","indeterminate","diameter","50","strokeWidth","4"],[1,"error-h1"]],template:function(e,i){e&1&&(u(0,W,2,1,"div",1)(1,B,3,0,"ng-container",2),v(2,"div",3,0),u(4,G,3,0,"ng-container",2)(5,J,3,1,"ng-container",2)),e&2&&(d("ngIf",i.videos()),r(),d("ngIf",i.isLoading()),r(3),d("ngIf",!i.isOnline()),r(),d("ngIf",i.error()))},dependencies:[N,A,U],encapsulation:2})};export{H as Search};
