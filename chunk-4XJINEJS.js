import{a as U}from"./chunk-HZ4FE6VA.js";import{$ as u,D as a,Ga as A,Ha as L,K as P,N as s,Oa as q,P as w,Qa as R,S as b,Ua as $,Va as F,Y as d,Z as r,_ as o,_a as Q,da as E,e as x,ea as M,g as m,ga as O,h as S,ia as C,ja as g,k as v,ma as D,n as y,na as V,o as _,oa as N,p as f,q as I,ta as l,ua as c,v as h,w as k,x as T}from"./chunk-VRIKBWOE.js";var Y=["searchSentinel"];function z(n,t){if(n&1){let e=O();r(0,"div",6),C("click",function(){let p=k(e).$implicit,j=g(2);return T(j.router.navigate(["/video",p.id.videoId]))}),r(1,"div",7),u(2,"img",8),o(),r(3,"div",9)(4,"h3"),l(5),o(),r(6,"div",10)(7,"p"),l(8),o()(),r(9,"div",11)(10,"p"),l(11),o()(),r(12,"div",12)(13,"p"),l(14),o()()()()}if(n&2){let e=t.$implicit,i=g(2);s(2),d("src",e.snippet.thumbnails.high==null?null:e.snippet.thumbnails.high.url,P),s(3),c(i.decodeHtml(e.snippet.title)),s(3),c(i.timeAgo(e.snippet.publishedAt)),s(3),c(e.snippet.channelTitle),s(3),c(e.snippet.description)}}function W(n,t){if(n&1&&(r(0,"div",4),b(1,z,15,5,"div",5),o()),n&2){let e=g();s(),d("ngForOf",e.videos())}}function B(n,t){n&1&&(E(0),r(1,"div",13),u(2,"mat-progress-spinner",14),o(),M())}var H=class n{searchSentinel;observer;decodeHtml=Q;timeAgo=F;videos=a([]);isLoading=a(!1);error=a(null);nextPageToken=a(null);query=a("");youtube=h($);route=h(q);router=h(R);destroy$=new x;ngOnInit(){this.route.queryParamMap.pipe(S(t=>(console.log(t.get("q")),t.get("q")??"")),y(),I(t=>{this.query.set(t),this.videos.set([]),this.nextPageToken.set(null)}),_(t=>{let e=this.nextPageToken()??void 0;return t?this.youtube.getSearchResults(t,e).pipe(v(i=>(this.error.set(i?.message??"Search failed"),m({items:[],nextPageToken:null})))):m({items:[],nextPageToken:null})}),f(this.destroy$)).subscribe({next:t=>{this.videos.set(t.items),this.nextPageToken.set(t.nextPageToken??null),this.isLoading.set(!1)},error:t=>{this.error.set(t?.message??"Unknown error"),this.isLoading.set(!1)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.observer.unobserve(this.searchSentinel.nativeElement),this.observer.disconnect()}ngAfterViewInit(){let t={root:null,rootMargin:"300px",threshold:1};this.observer=new IntersectionObserver(e=>{for(let i of e)i.isIntersecting&&this.loadMoreSearchVideos()},t),this.observer.observe(this.searchSentinel.nativeElement)}loadMoreSearchVideos(){let t=this.query(),e=this.nextPageToken();!t||!e||(this.isLoading.set(!0),this.youtube.getSearchResults(t,e).pipe(v(i=>(this.error.set(i?.message??"Load more failed"),m({items:[],nextPageToken:null}))),f(this.destroy$)).subscribe(i=>{this.videos.set([...this.videos(),...i.items??[]]),this.nextPageToken.set(i.nextPageToken??null),this.isLoading.set(!1)}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=w({type:n,selectors:[["app-search"]],viewQuery:function(e,i){if(e&1&&D(Y,5),e&2){let p;V(p=N())&&(i.searchSentinel=p.first)}},decls:4,vars:2,consts:[["searchSentinel",""],["class","search-page-parent",4,"ngIf"],[4,"ngIf"],["aria-hidden","true",1,"search-sentinel"],[1,"search-page-parent"],["class","search-video",3,"click",4,"ngFor","ngForOf"],[1,"search-video",3,"click"],[1,"search-video-left"],["alt","video thumbnail",3,"src"],[1,"search-video-right"],[1,"search-video-details"],[1,"search-video-channel-details"],[1,"search-video-desc"],[1,"loading-spinner"],["mode","indeterminate","diameter","50","strokeWidth","4"]],template:function(e,i){e&1&&(b(0,W,2,1,"div",1)(1,B,3,0,"ng-container",2),u(2,"div",3,0)),e&2&&(d("ngIf",i.videos()),s(),d("ngIf",i.isLoading()))},dependencies:[L,A,U],encapsulation:2})};export{H as Search};
