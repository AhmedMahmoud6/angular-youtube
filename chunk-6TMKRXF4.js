import{a as U}from"./chunk-HZ4FE6VA.js";import{$ as g,D as a,Ga as A,Ha as N,K as E,N as o,Oa as q,P,Qa as R,S as u,Ua as $,Va as F,Y as d,Z as r,_ as s,_a as Q,da as b,e as y,ea as x,g as p,ga as C,h as _,ia as M,ja as v,k as f,ma as D,n as I,na as L,o as k,oa as V,p as S,q as w,ta as l,ua as c,v as h,w as T,x as O}from"./chunk-VRIKBWOE.js";var j=["searchSentinel"];function z(n,e){if(n&1){let t=C();r(0,"div",6),M("click",function(){let m=T(t).$implicit,Y=v(2);return O(Y.router.navigate(["/video",m.id.videoId]))}),r(1,"div",7),g(2,"img",8),s(),r(3,"div",9)(4,"h3"),l(5),s(),r(6,"div",10)(7,"p"),l(8),s()(),r(9,"div",11)(10,"p"),l(11),s()(),r(12,"div",12)(13,"p"),l(14),s()()()()}if(n&2){let t=e.$implicit,i=v(2);o(2),d("src",t.snippet.thumbnails.high==null?null:t.snippet.thumbnails.high.url,E),o(3),c(i.decodeHtml(t.snippet.title)),o(3),c(i.timeAgo(t.snippet.publishedAt)),o(3),c(t.snippet.channelTitle),o(3),c(t.snippet.description)}}function W(n,e){if(n&1&&(r(0,"div",4),u(1,z,15,5,"div",5),s()),n&2){let t=v();o(),d("ngForOf",t.videos())}}function B(n,e){n&1&&(b(0),r(1,"div",13),g(2,"mat-progress-spinner",14),s(),x())}function G(n,e){n&1&&(b(0),r(1,"h1",15),l(2,"You're Offline, Check your Internet And Try Again"),s(),x())}var H=class n{searchSentinel;observer;decodeHtml=Q;timeAgo=F;videos=a([]);isLoading=a(!1);error=a(null);nextPageToken=a(null);query=a("");youtube=h($);route=h(q);router=h(R);destroy$=new y;isOnline=a(window.navigator.onLine);ngOnInit(){this.route.queryParamMap.pipe(_(e=>(console.log(e.get("q")),e.get("q")??"")),I(),w(e=>{this.query.set(e),this.videos.set([]),this.nextPageToken.set(null)}),k(e=>{let t=this.nextPageToken()??void 0;return e?this.youtube.getSearchResults(e,t).pipe(f(i=>(this.error.set(i?.message??"Search failed"),p({items:[],nextPageToken:null})))):p({items:[],nextPageToken:null})}),S(this.destroy$)).subscribe({next:e=>{this.videos.set(e.items),this.nextPageToken.set(e.nextPageToken??null),this.isLoading.set(!1)},error:e=>{this.error.set(e?.message??"Unknown error"),this.isLoading.set(!1)}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.observer.unobserve(this.searchSentinel.nativeElement),this.observer.disconnect()}ngAfterViewInit(){let e={root:null,rootMargin:"300px",threshold:1};this.observer=new IntersectionObserver(t=>{for(let i of t)i.isIntersecting&&this.loadMoreSearchVideos()},e),this.observer.observe(this.searchSentinel.nativeElement)}loadMoreSearchVideos(){let e=this.query(),t=this.nextPageToken();!e||!t||(this.isLoading.set(!0),this.youtube.getSearchResults(e,t).pipe(f(i=>(this.error.set(i?.message??"Load more failed"),p({items:[],nextPageToken:null}))),S(this.destroy$)).subscribe(i=>{this.videos.set([...this.videos(),...i.items??[]]),this.nextPageToken.set(i.nextPageToken??null),this.isLoading.set(!1)}))}constructor(){window.addEventListener("online",()=>{this.isOnline.set(!0)}),window.addEventListener("offline",()=>{this.isOnline.set(!1)})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=P({type:n,selectors:[["app-search"]],viewQuery:function(t,i){if(t&1&&D(j,5),t&2){let m;L(m=V())&&(i.searchSentinel=m.first)}},decls:5,vars:3,consts:[["searchSentinel",""],["class","search-page-parent",4,"ngIf"],[4,"ngIf"],["aria-hidden","true",1,"search-sentinel"],[1,"search-page-parent"],["class","search-video",3,"click",4,"ngFor","ngForOf"],[1,"search-video",3,"click"],[1,"search-video-left"],["alt","video thumbnail",3,"src"],[1,"search-video-right"],[1,"search-video-details"],[1,"search-video-channel-details"],[1,"search-video-desc"],[1,"loading-spinner"],["mode","indeterminate","diameter","50","strokeWidth","4"],[1,"error-h1"]],template:function(t,i){t&1&&(u(0,W,2,1,"div",1)(1,B,3,0,"ng-container",2),g(2,"div",3,0),u(4,G,3,0,"ng-container",2)),t&2&&(d("ngIf",i.videos()),o(),d("ngIf",i.isLoading()),o(3),d("ngIf",!i.isOnline()))},dependencies:[N,A,U],encapsulation:2})};export{H as Search};
