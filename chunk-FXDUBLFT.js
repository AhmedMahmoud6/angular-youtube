import{Da as b,Ea as w,a as m,b as f,h,l as g,p as v,s as $}from"./chunk-LJAEMB3T.js";var d={production:!1,apiKey:"AIzaSyDWsKhi_G5QGsBNKcCpXmf7ARoU19ues2M",videosUrl:"https://www.googleapis.com/youtube/v3",channelUrl:"https://www.googleapis.com/youtube/v3/channels"};var x=class t{constructor(e){this.http=e}apiKey=d.apiKey;apiUrl=d.videosUrl;channelUrl=d.channelUrl;params={part:"snippet,statistics,contentDetails",chart:"mostPopular",regionCode:"EG",maxResults:"20"};videoParams={part:"snippet,statistics,contentDetails"};getVideos(e){let n=m(m({},this.params),e?{pageToken:e}:{}),r=new b({fromObject:n});return this.http.get(`${this.apiUrl}/videos?key=${this.apiKey}`,{params:r})}getVideoById(e){return this.http.get(`${this.apiUrl}/videos?key=${this.apiKey}&id=${e}`,{params:this.videoParams})}getChannel(e){return this.http.get(`${this.channelUrl}?key=${this.apiKey}&id=${e}&part=brandingSettings`,{params:this.videoParams})}getVideoComments(e,n){if(!e)return console.error("getVideoComments called without videoId!"),h(()=>new Error("videoId is required"));let r=f(m({part:"snippet,replies",order:"relevance"},n?{pageToken:n}:{}),{videoId:e}),s=new b({fromObject:r});return this.http.get(`${this.apiUrl}/commentThreads?key=${this.apiKey}`,{params:s})}static \u0275fac=function(n){return new(n||t)($(w))};static \u0275prov=v({token:t,factory:t.\u0275fac,providedIn:"root"})};function K(t){let e=new Date(t),r=(new Date().getTime()-e.getTime())/1e3,s={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(let l in s){let o=Math.floor(r/s[l]);if(o>=1)return`${o} ${l}${o>1?"s":""} ago`}return"just now"}function W(t,e="views"){let n=typeof t=="string"?parseInt(t):t;return n>=1e9?(n/1e9).toFixed(1).replace(/\.0$/,"")+`B ${e}`:n>=1e6?(n/1e6).toFixed(1).replace(/\.0$/,"")+`M ${e}`:n>=1e3?(n/1e3).toFixed(1).replace(/\.0$/,"")+`K ${e}`:n+` ${e}`}function E(t,e){let n=e[0];return{videoDetails:{contentDetails:{duration:t.contentDetails.duration},statistics:{viewCount:t.statistics.viewCount,commentCount:t.statistics.commentCount,likeCount:t.statistics.likeCount,subscriberCount:n.statistics.subscriberCount},snippet:{thumbnails:t.snippet.thumbnails,channelId:t.snippet.channelId,title:t.snippet.title,channelTitle:t.snippet.channelTitle,publishedAt:t.snippet.publishedAt,description:t.snippet.description},id:t.id,brandingSettings:{image:{bannerExternalUrl:n.brandingSettings.image?.bannerExternalUrl??""}}},channelId:n.id,channelProfilePic:n.snippet.thumbnails.default?.url??""}}function j(t){let e=t.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/),n=parseInt(e?.[1]||"0",10),r=parseInt(e?.[2]||"0",10),s=parseInt(e?.[3]||"0",10);return n>0?`${n}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${r}:${s.toString().padStart(2,"0")}`}function D(t){if(t==null)return"N/A subscribers";let e=typeof t=="string"?parseInt(t):t;return isNaN(e)||e<0?"0 subscribers":e>=1e9?(e/1e9).toFixed(1).replace(/\.0$/,"")+"B subscribers":e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M subscribers":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"K subscribers":e+" subscribers"}function V(t,e,n,r,s,l,o,c,u){if(s==="videos"){if(t()||e()===null&&o().length>0)return;t.set(!0);let p=e()??void 0;n.getVideos(p).pipe(g(1)).subscribe({next:i=>{let a=i.items??[];o?.set([...o(),...a]),e.set(i.nextPageToken??null),i.nextPageToken||r?.disconnect()},error:i=>{console.error(i),l?.set("Failed To Load Videos")},complete:()=>t.set(!1)})}else if(s==="comments"){if(!u){console.warn("loadMore: missing videoId -> abort");return}if(t()){console.log("loadMore: already loading -> abort");return}if(e()===null&&c().length>0){console.log("loadMore: nextPageToken is null and have items -> abort");return}t.set(!0);let p=e()??void 0;n.getVideoComments(u,p).pipe(g(1)).subscribe({next:i=>{let a=i.items??[];c?.set([...c(),...a]),e.set(i.nextPageToken??null),i.nextPageToken||r?.disconnect()},error:i=>{console.error("loadMore: comments error",i),l?.set("Failed To Load Comments")},complete:()=>{t.set(!1)}})}}function N(t,e,n,r,s,l,o,c,u,p){if(!t?.nativeElement){console.warn("setupObserver: sentinel not available yet");return}let i={root:null,rootMargin:"300px",threshold:0},a;return e.runOutsideAngular(()=>{a=new IntersectionObserver(y=>{for(let S of y)S.isIntersecting&&e.run(()=>V(n,r,s,a,l,o,c,u,p))},i),a.observe(t.nativeElement)}),a}export{x as a,K as b,W as c,E as d,j as e,D as f,V as g,N as h};
